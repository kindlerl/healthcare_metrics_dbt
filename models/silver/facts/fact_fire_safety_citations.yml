version: 2

models:
  - name: fact_fire_safety_citations
    description: Fire safety deficiency citation history, including inspection cycle and corrections

    columns:
    - name: citation_sk
      description: "Surrogate key generated from provider_id, survey_date, deficiency_id."
      tests: [not_null, unique]

    - name: provider_id
      description: "CMS certification number (natural key)"
      tests: [not_null]

    - name: survey_date
      description: "Date survey was taken"
      tests: [not_null]

    - name: survey_type
      description: "Survey type (typically 'health' survey)"
      tests: [not_null]

    - name: deficiency_id
      description: "Combination of deficiency_prefix and deviciency_tag_number; used as foreign key"
      tests: [not_null]

    - name: deficiency_prefix
      description: "deficiency_prefix field"
      tests:
        - not_null
        - accepted_values:
            values: ['E', 'K']

    - name: deficiency_tag_number
      description: "deficiency_tag_number field"
      tests: [not_null]

    - name: tag_version
      description: "Tag version"

    - name: deficiency_category
      description: "Deficiency category (list of pre-defined categoreies)"
      tests: [not_null]

    - name: deficiency_description
      description: "Description of deficiency (predefined)"
      tests: [not_null]

    - name: scope_severity_code
      description: "scope_severity_code field"
      tests: 
        - not_null
        - accepted_values:
            values: ['B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L']

    - name: deficiency_corrected
      description: "Deficiency correction status"
      tests: [not_null]

    - name: correction_date
      description: "Date of deficiency correction"

    - name: inspection_cycle
      description: "inspection_cycle field"
      tests: 
        - not_null
        - accepted_values:
            values: ['1', '2', '3']

    - name: standard_deficiency
      description: "Standard deficiency (boolean)"
      tests: [not_null]

    - name: complaint_deficiency
      description: "Complaint deficiency (boolean)"
      tests: [not_null]

    - name: infection_control_inspection_deficiency
      description: "Inspection control deficiency (boolean)"
      tests: [not_null]

    - name: citation_under_idr
      description: "Independant dispute resolution (boolean)"
      tests: [not_null]

    - name: citation_under_iidr
      description: "Informal independant dispute resolution (boolean)"
      tests: [not_null]
